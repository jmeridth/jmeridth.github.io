<!doctype html><html lang=en><head><meta charset=utf-8><title>Raspberry Pi Kubernetes Cluster - Part 4 | JM (Jason Meridth)</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.99.1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content="kubernetes,raspberrypi"><meta name=description content="Raspberry Pi Kubenetes Cluster - Part 1
Raspberry Pi Kubenetes Cluster - Part 2
Raspberry Pi Kubenetes Cluster - Part 3
Raspberry Pi Kubenetes Cluster - …"><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet type=text/css media=screen href=/css/all.css><link rel=stylesheet href=/css/katex.css crossorigin=anonymous><script defer src=/js/katex.js integrity=sha384-HELAAZU8xvHgfT/8z4Mhmu+E2z3oBrMEuywaMh/CEd5uTZIDSct7TEaX+S43+dOi crossorigin=anonymous></script>
<script defer src=/js/auto-render.js integrity=sha384-0QrOZ8WIARJUoT5pH7Iuzi7iq0mXUXLF9yj5ZvYxTkMRv1zcaPQiOQ9ksHYbKw7M crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><meta property="og:title" content="Raspberry Pi Kubernetes Cluster - Part 4"><meta property="og:description" content="Raspberry Pi Kubenetes Cluster - Part 1
Raspberry Pi Kubenetes Cluster - Part 2
Raspberry Pi Kubenetes Cluster - Part 3
Raspberry Pi Kubenetes Cluster - Part 4
Howdy again.
In this post I&rsquo;m going to show you how to create a docker image to run on ARM architecture and also how to deploy it and view it.
To start please view my basic flask application called fl8 here
If you&rsquo;d like to clone and use it:
git clone git@github.com:meridth/fl8.git && cd fl8
ARM docker image
First we need to learn about QEMU
What is QEMU and QEMU installation
QEMU (Quick EMUlator) is an Open-Source hosted hypervisor, i.e. an hypervisor running on a OS just as other computer programs, which performs hardware virtualization. QEMU emulates CPUs of several architectures, e.g. x86, PPC, ARM and SPARC. It allows the execution of non-native target executables emulating the native execution and, as we require in this case, the cross-building process."><meta property="og:type" content="article"><meta property="og:url" content="http://blog.jasonmeridth.com/posts/raspberry-pi-kubernetes-cluster-part-4/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-12-28T10:35:23+00:00"><meta property="article:modified_time" content="2018-12-28T10:35:23+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Raspberry Pi Kubernetes Cluster - Part 4"><meta name=twitter:description content="Raspberry Pi Kubenetes Cluster - Part 1
Raspberry Pi Kubenetes Cluster - Part 2
Raspberry Pi Kubenetes Cluster - Part 3
Raspberry Pi Kubenetes Cluster - Part 4
Howdy again.
In this post I&rsquo;m going to show you how to create a docker image to run on ARM architecture and also how to deploy it and view it.
To start please view my basic flask application called fl8 here
If you&rsquo;d like to clone and use it:
git clone git@github.com:meridth/fl8.git && cd fl8
ARM docker image
First we need to learn about QEMU
What is QEMU and QEMU installation
QEMU (Quick EMUlator) is an Open-Source hosted hypervisor, i.e. an hypervisor running on a OS just as other computer programs, which performs hardware virtualization. QEMU emulates CPUs of several architectures, e.g. x86, PPC, ARM and SPARC. It allows the execution of non-native target executables emulating the native execution and, as we require in this case, the cross-building process."><meta itemprop=name content="Raspberry Pi Kubernetes Cluster - Part 4"><meta itemprop=description content="Raspberry Pi Kubenetes Cluster - Part 1
Raspberry Pi Kubenetes Cluster - Part 2
Raspberry Pi Kubenetes Cluster - Part 3
Raspberry Pi Kubenetes Cluster - Part 4
Howdy again.
In this post I&rsquo;m going to show you how to create a docker image to run on ARM architecture and also how to deploy it and view it.
To start please view my basic flask application called fl8 here
If you&rsquo;d like to clone and use it:
git clone git@github.com:meridth/fl8.git && cd fl8
ARM docker image
First we need to learn about QEMU
What is QEMU and QEMU installation
QEMU (Quick EMUlator) is an Open-Source hosted hypervisor, i.e. an hypervisor running on a OS just as other computer programs, which performs hardware virtualization. QEMU emulates CPUs of several architectures, e.g. x86, PPC, ARM and SPARC. It allows the execution of non-native target executables emulating the native execution and, as we require in this case, the cross-building process."><meta itemprop=datePublished content="2018-12-28T10:35:23+00:00"><meta itemprop=dateModified content="2018-12-28T10:35:23+00:00"><meta itemprop=wordCount content="383"><meta itemprop=keywords content="kubernetes,raspberrypi,"></head><body><header><div id=avatar><a href=http://blog.jasonmeridth.com/><img src=/img/avatar.jpg alt="JM (Jason Meridth)"></a></div><div id=titletext><h2 id=title><a href=http://blog.jasonmeridth.com/>JM (Jason Meridth)</a></h2></div><div id=title-description><p id=subtitle>Learn, Converse, Share</p><div id=social><nav><ul><li><a href=https://github.com/jmeridth><i title=Github class="icons fab fa-github"></i></a></li><li><a href=mailto:jmeridth@gmail.com><i title=Email class="icons fas fa-envelope"></i></a></li><li><a href=https://linkedin.com/in/jmeridth><i title=LinkedIn class="icons fab fa-linkedin"></i></a></li><li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li><li><a><i title="Switch Dark Mode" class="dark-mode icons fas fa-moon"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All Posts</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li><li><a href=/categories>Categories</a></li></ul></nav></div></header><main><div class=post><article><div class=post-header><div class=meta><div class=date><span class=day>28</span>
<span class=rest>Dec 2018</span></div></div><div class=matter><h1 class=title>Raspberry Pi Kubernetes Cluster - Part 4</h1><p class=post-meta><span class=post-meta>&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;minutes
&nbsp;| &nbsp;
<i class="fas fa-book"></i>&nbsp;383&nbsp;words</span></p></div></div><div class=markdown><p><a href=/posts/raspberry-pi-kubernetes-cluster-part-1>Raspberry Pi Kubenetes Cluster - Part 1</a></p><p><a href=/posts/raspberry-pi-kubernetes-cluster-part-2>Raspberry Pi Kubenetes Cluster - Part 2</a></p><p><a href=/posts/raspberry-pi-kubernetes-cluster-part-3>Raspberry Pi Kubenetes Cluster - Part 3</a></p><p><a href=/posts/raspberry-pi-kubernetes-cluster-part-4>Raspberry Pi Kubenetes Cluster - Part 4</a></p><p>Howdy again.</p><p>In this post I&rsquo;m going to show you how to create a docker image to run on ARM architecture and also how to deploy it and view it.</p><p>To start please view my basic flask application called fl8 <a href=https://github.com/meridth/fl8 target=_blank>here</a></p><p>If you&rsquo;d like to clone and use it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:meridth/fl8.git <span style=color:#f92672>&amp;&amp;</span> cd fl8
</span></span></code></pre></div><h2 id=arm-docker-image>ARM docker image</h2><p>First we need to learn about QEMU</p><h3 id=what-is-qemu-and-qemu-installation>What is QEMU and QEMU installation</h3><p>QEMU (Quick EMUlator) is an Open-Source hosted hypervisor, i.e. an hypervisor running on a OS just as other computer programs, which performs hardware virtualization. QEMU emulates CPUs of several architectures, e.g. x86, PPC, ARM and SPARC. It allows the execution of non-native target executables emulating the native execution and, as we require in this case, the cross-building process.</p><h3 id=base-docker-image-that-includes-qemu>Base Docker image that includes QEMU</h3><p>Please open the <code>Dockerfile.arm</code> and notice the first line: <code>FROM hypriot/rpi-alpine</code>. This is a base image that includes the target qemu statically linked executable, <em>qemu-arm-static</em> in this case. I chose <code>hypriot/rpi-alpine</code> because the alpine base images are much smaller than other base images.</p><h3 id=register-qemu-in-the-build-agent>Register QEMU in the build agent</h3><p>To add QEMU in the build agent there is a specific Docker Image performing what we need, so just run in your command line:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm --privileged multiarch/qemu-user-static:register --reset
</span></span></code></pre></div><h3 id=build-image>Build image</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -f ./Dockerfile.arm -t meridth/rpi-fl8 .
</span></span></code></pre></div><p>And voila! You now have an image that will run on Raspberry Pis.</p><h2 id=deployment-and-service>Deployment and Service</h2><p><code>/.run-rpi.sh</code> is my script where I run a Kubernetes deployment with 3 replicas and a Kubernetes service. Please read <code>fl8-rpi-deployment.yml</code> and <code>fl8-rpi-service.yml</code>. They are only different from the other deployment and service files by labels. Labels are key/vaule pairs that can be used by selectors later.</p><p>The deployment will pull my image from <code>meridth/rpi-fl8</code> on dockerhub. If you have uploaded your docker image somewhere you can change the deployment file to pull that image instead.</p><h2 id=viewing-application>Viewing application</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><p>Choose a pod to create the port forwarding ssh tunnel.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl port-forward <span style=color:#f92672>[</span>pod-name<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>app-port<span style=color:#f92672>]</span>:<span style=color:#f92672>[</span>app-port<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Example: <code>kubectl port-forward rpi-fl8-5d84dd8ff6-d9tgz 5010:5010</code></p><p>The final result when you go to <code>http://localhost:5010</code> in a browser.</p><p><figure><img src=/img/kubernetes_cluster/port_forward.png alt="port forward result"></figure></p><p>Hope this helps someone else. Cheers.</p></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/kubernetes/>kubernetes</a>
<a href=/tags/raspberrypi/>raspberrypi</a></p></div><div class=clearit></div></div></article></div></main><footer>© Copyright notice | <a href=https://github.com/dataCobra/hugo-vitae target=_blank>Vitae</a> theme for <a href=https://gohugo.io target=_blank>Hugo</a>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-38456568-3","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></footer><script src=/js/dark-mode.js></script></body></html>