<!doctype html><html lang=en><head><meta charset=UTF-8><title>Gitosis and Gitweb - Part 3 | Jason Meridth</title>
<meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo 0.124.1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content="git,gitosis"><meta name=description content="Gitosis and Gitweb – Part 1
Gitosis and Gitweb – Part 2
So we are setup, have a project, and have contributors via the first 2 parts.
I know that we are …"><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet type=text/css media=screen href=/css/all.css><link rel=stylesheet href=/css/katex.css crossorigin=anonymous><script defer src=/js/katex.js integrity=sha384-HELAAZU8xvHgfT/8z4Mhmu+E2z3oBrMEuywaMh/CEd5uTZIDSct7TEaX+S43+dOi crossorigin=anonymous></script><script defer src=/js/auto-render.js integrity=sha384-0QrOZ8WIARJUoT5pH7Iuzi7iq0mXUXLF9yj5ZvYxTkMRv1zcaPQiOQ9ksHYbKw7M crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4W46VMK7DQ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4W46VMK7DQ")</script><meta property="og:title" content="Gitosis and Gitweb - Part 3"><meta property="og:description" content="Gitosis and Gitweb – Part 1
Gitosis and Gitweb – Part 2
So we are setup, have a project, and have contributors via the first 2 parts.
I know that we are all enamored by the UI of GitHub.com. I am. Unfortunately you can’t get private repositories for free (In all fairness it’s only $7/mo. – a very wise investment). I am aware of Gitorious like I mentioned in the first part, but I have no experience with that."><meta property="og:type" content="article"><meta property="og:url" content="http://blog.jasonmeridth.com/posts/gitosis-and-gitweb-part-3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-05-26T04:45:00-05:00"><meta property="article:modified_time" content="2022-02-15T20:12:38-06:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gitosis and Gitweb - Part 3"><meta name=twitter:description content="Gitosis and Gitweb – Part 1
Gitosis and Gitweb – Part 2
So we are setup, have a project, and have contributors via the first 2 parts.
I know that we are all enamored by the UI of GitHub.com. I am. Unfortunately you can’t get private repositories for free (In all fairness it’s only $7/mo. – a very wise investment). I am aware of Gitorious like I mentioned in the first part, but I have no experience with that."><meta itemprop=name content="Gitosis and Gitweb - Part 3"><meta itemprop=description content="Gitosis and Gitweb – Part 1
Gitosis and Gitweb – Part 2
So we are setup, have a project, and have contributors via the first 2 parts.
I know that we are all enamored by the UI of GitHub.com. I am. Unfortunately you can’t get private repositories for free (In all fairness it’s only $7/mo. – a very wise investment). I am aware of Gitorious like I mentioned in the first part, but I have no experience with that."><meta itemprop=datePublished content="2010-05-26T04:45:00-05:00"><meta itemprop=dateModified content="2022-02-15T20:12:38-06:00"><meta itemprop=wordCount content="871"><meta itemprop=keywords content="git,gitosis,"></head><body><header><div id=avatar><a href=http://blog.jasonmeridth.com/><img src=/img/avatar.jpg alt="Jason Meridth"></a></div><div id=titletext><h2 id=title><a href=http://blog.jasonmeridth.com/>Jason Meridth</a></h2></div><div id=title-description><p id=subtitle>Learn, Converse, Share</p><div id=social><nav><ul><li><a href=https://github.com/jmeridth><i title=Github class="icons fab fa-github"></i></a></li><li><a href=mailto:jmeridth@gmail.com><i title=Email class="icons fas fa-envelope"></i></a></li><li><a href=https://linkedin.com/in/jmeridth><i title=LinkedIn class="icons fab fa-linkedin"></i></a></li><li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li><li><a><i title="Switch Dark Mode" class="dark-mode icons fas fa-moon"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All Posts</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li><li><a href=/categories>Categories</a></li></ul></nav></div></header><main><div class=post><article><div class=post-header><div class=meta><div class=date><span class=day>26</span>
<span class=rest>May 2010</span></div></div><div class=matter><h1 class=title>Gitosis and Gitweb - Part 3</h1><p class=post-meta><span class=post-meta>&nbsp;<i class="fas fa-clock"></i>&nbsp;5&nbsp;minutes
&nbsp;| &nbsp;
<i class="fas fa-book"></i>&nbsp;871&nbsp;words</span></p></div></div><div class=markdown><p><a href=/posts/gitosis-and-gitweb-part-1>Gitosis and Gitweb – Part 1</a></p><p><a href=/posts/gitosis-and-gitweb-part-2>Gitosis and Gitweb – Part 2</a></p><p>So we are setup, have a project, and have contributors via the first 2 parts.</p><p>I know that we are all enamored by the UI of <a href=http://github.com target=_blank>GitHub.com</a>. I am. Unfortunately you can’t get private repositories for free (In all fairness it’s only $7/mo. – a <em>very</em> wise investment). I am aware of <a href=http://gitorious.com target=_blank>Gitorious</a> like I mentioned in the first part, but I have no experience with that. I will after this series and update this series if I find it better. Again, I like to use the simplest thing that works. (Of course, “simplest” is in the eye of the beholder)</p><p>In this section I’m going to show you how to install Gitweb, a UI tool that let’s you view your repositories. I’m also going to mention how to get it to auto-detect any new repositories and ensure they show up on the web UI. I learned how to do most of this from my co-worker <a href=http://twitter.com/ajmesserli target=_blank>Antony Messerli</a>. He is a true Linux and problem-solving Jedi.</p><h2 id=install-apache>Install Apache</h2><p>First, you need to ensure apache2 is installed. Check to see if you have an /etc/apache2 folder. If you do, you should be okay. If you don’t, you need to install it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install apache2
</span></span></code></pre></div><p>For more in-depth advice, I always reference the <a href=http://articles.slicehost.com/2010/5/19/installing-apache-on-ubuntu target=_blank>Slicehost Articles</a></p><p>Once you have that installed the daemon restarted, go to your slices ip address in the browser of your choice (i.e,. <a href=http://123.123.123.123 target=_blank>http://123.123.123.123</a>) and you should something like “It Works”</p><p>Voila! You have apache running.</p><h2 id=install-the-package>Install the Package</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install gitweb
</span></span></code></pre></div><p>This will install gitweb into /var/www/gitweb, create a conf file at /etc/gitweb.conf, and add three files to /usr/share/gitweb (git-favicon.png, git-logo.png, gitweb.css).</p><p>Note: If for some reason, the /var/www/gitweb folder <em>is not</em> created, you can clone the git source (git clone git://git.kernel.org/pub/scm/git/git.git) and then just copy the git/gitweb folder to /var/www/gitweb</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp -R git/gitweb /var/www/
</span></span></code></pre></div><p>You only need to edit the $projectroot variable in the /etc/gitweb.conf to point to your gitosis repositories folder:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># path to git projects (&lt;project&gt;.git)</span>
</span></span><span style=display:flex><span>$projectroot <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/home/git/repositories&#34;</span>;
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Since this isn’t a post about Apache, I just add the gitweb directory setup to the base Apache config. Since Ubuntu includes the entire /etc/apache2/conf.d directory, I just added the following information into /etc/apach2/conf.d/gitweb:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>RewriteEngine on
</span></span><span style=display:flex><span>RewriteRule ^/gitweb/<span style=color:#f92672>([</span>a-zA-Z0-9_<span style=color:#ae81ff>\-</span><span style=color:#f92672>]</span>+<span style=color:#ae81ff>\.</span>git<span style=color:#f92672>)</span>/?<span style=color:#f92672>(</span><span style=color:#ae81ff>\?</span>.*<span style=color:#f92672>)</span>?$ /cgi-bin/gitweb.cgi/$1 <span style=color:#f92672>[</span>L,PT<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Alias /gitweb /home/git/repositories
</span></span><span style=display:flex><span>&lt;Directory /home/git/repositories&gt;
</span></span><span style=display:flex><span>Options Indexes FollowSymlinks ExecCGI
</span></span><span style=display:flex><span>DirectoryIndex /cgi-bin/gitweb.cgi
</span></span><span style=display:flex><span>AllowOverride None
</span></span><span style=display:flex><span>&lt;/Directory&gt;
</span></span></code></pre></div><p>Restart Apache to make sure everything works</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo /etc/init.d/apache2 restart
</span></span></code></pre></div><p>The first time you go to your website again, you’ll see Gitweb, but it’ll say no projects are available. Fix mentioned below.</p><h3 id=two-hacks-open-to-suggestions>Two Hacks (open to suggestions)</h3><p>1. I had to copy the git-favicon.png, git-logo.png, gitweb.css files from /usr/share/gitweb to /var/www/gitweb/. (if you had to do what is mentioned in the Note above, you don’t have to do this, since the gitweb folder from the git source clone includes these files already)</p><p>2. I had to make the repositories that I wanted visible in gitweb have permissions of 755 (aka owner has read, write, execute. group and others have read, execute.)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chmod -R <span style=color:#ae81ff>755</span> /git/repositories/lostechies.git
</span></span></code></pre></div><p>Once that was done I can see the repository and it’s information on Gitweb.</p><p><figure><img src=/img/gitweb-part3.png alt></figure></p><p>If you want to edit the project description from &ldquo;Unnamed repository; edit this file &lsquo;description&rsquo; to name the repository.&rdquo; go to the repositories description file (/home/git/repositories/          lostechies.git/description for this repo) and edit the file and save.</p><h3 id=cron-job>Cron job</h3><p>I, again with the leadership of Ant, utilized a cron job he wrote to automatically make the repositories have permissions of 755. I do have some repositories, like gitosis-admin, that I do not ever want visible on Gitweb. The cron job excludes them. Here is the cron job code, showing that I don’t want to show my personal.git and gitosis-admin.git repositories. This could be easily written in Ruby or any other “scripting language” of your choice:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>GITOSIS_REPO_PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/home/git/repositories&#34;</span>
</span></span><span style=display:flex><span>GITOSIS_ADMIN_PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$GITOSIS_REPO_PATH<span style=color:#e6db74>/gitosis-admin.git&#34;</span>
</span></span><span style=display:flex><span>PERSON_REPO_PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$GITOSIS_REPO_PATH<span style=color:#e6db74>/personal.git&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>debug <span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[D]: </span>$1<span style=color:#e6db74>&#34;</span> &gt; /dev/null
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> dir in <span style=color:#e6db74>`</span>find $GITOSIS_REPO_PATH -maxdepth <span style=color:#ae81ff>1</span> -mindepth <span style=color:#ae81ff>1</span> -type d<span style=color:#e6db74>`</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$dir<span style=color:#e6db74>&#34;</span> !<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span>$GITOSIS_ADMIN_PATH<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$dir<span style=color:#e6db74>&#34;</span> !<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span>$PERSON_REPO_PATH<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>             <span style=color:#e6db74>`</span>chmod -R <span style=color:#ae81ff>0755</span> $dir<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    debug <span style=color:#e6db74>&#34;All repositories have permissions set to 0755&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>I chose bash, so that I could take that time to learn it.
Translation: Find all the directories in my gitosis repository path (/home/git/repositories) and if they are not gitosis-admin or personal, change their permissions, recursively, to 0755.</p><p>I put this in a file called set_gitosis_permissions_to_view_on_gitweb.sh and put it in root’s home folder, /root. I then called the file from root’s crontab:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~ /&gt; sudo su -
</span></span><span style=display:flex><span><span style=color:#75715e># /root &gt; crontab -e</span>
</span></span><span style=display:flex><span><span style=color:#75715e># m h dom mon dow  command</span>
</span></span><span style=display:flex><span>*/5 * * * * /root/set_gitosis_permissions_to_view_on_gitweb.sh
</span></span></code></pre></div><p>This means that every 5 minutes, my bash file will set any new repositories to 0755. This is how to get Gitweb stood up. The next post will show how to hide it behind HTTP basic auth and a self-signed certificate.</p><p>Next Part: Hiding the Gitweb site</p><h2 id=comments>Comments</h2><p><strong><a href=#483 title="2010-07-09 22:07:08">katy lavallee</a>:</strong> Anxiously awaiting the next part :)</p><p><strong><a href=#513 title="2011-11-05 01:16:00">Thorpe</a>:</strong> You said you chose Bash so that you could take some time to learn it. Unfortunately however, your shebang points to sh not bash. There is some differences.</p></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/git/>git</a>
<a href=/tags/gitosis/>gitosis</a></p></div><div class=clearit></div></div></article></div></main><footer>© Copyright notice | <a href=https://github.com/dataCobra/hugo-vitae target=_blank>Vitae</a> theme for <a href=https://gohugo.io target=_blank>Hugo</a></footer><script src=/js/dark-mode.js></script></body></html>