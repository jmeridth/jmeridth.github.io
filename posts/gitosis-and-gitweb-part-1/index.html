<!doctype html><html lang=en><head><title>Gitosis and Gitweb - Part 1 - Setup · Learn, Converse, Share</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Jason Meridth"><meta name=description content="I’ve had a number of people ask me where they should host their Git repositories. Of course, my default question back is, “Can the code be public or does it need to be private?”. Usually they say, “public”. Therefore, my repsonse is Github.com. If they say, “private” I still say Github. If they don&rsquo;t &ldquo;trust&rdquo; Github, which they should - click the link, then my response is Gitosis and Gitweb. This is by no means the only solution. I’m aware of other ones like Gitorious. I’ve never used Gitorious."><meta name=keywords content="jason meridth,meridth,jm,software developer"><meta name=fediverse:creator content><meta name=twitter:card content="summary"><meta name=twitter:title content="Gitosis and Gitweb - Part 1 - Setup"><meta name=twitter:description content="I’ve had a number of people ask me where they should host their Git repositories. Of course, my default question back is, “Can the code be public or does it need to be private?”. Usually they say, “public”. Therefore, my repsonse is Github.com. If they say, “private” I still say Github. If they don’t “trust” Github, which they should - click the link, then my response is Gitosis and Gitweb. This is by no means the only solution. I’m aware of other ones like Gitorious. I’ve never used Gitorious."><meta property="og:url" content="http://jmeridth.com/posts/gitosis-and-gitweb-part-1/"><meta property="og:site_name" content="Learn, Converse, Share"><meta property="og:title" content="Gitosis and Gitweb - Part 1 - Setup"><meta property="og:description" content="I’ve had a number of people ask me where they should host their Git repositories. Of course, my default question back is, “Can the code be public or does it need to be private?”. Usually they say, “public”. Therefore, my repsonse is Github.com. If they say, “private” I still say Github. If they don’t “trust” Github, which they should - click the link, then my response is Gitosis and Gitweb. This is by no means the only solution. I’m aware of other ones like Gitorious. I’ve never used Gitorious."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-05-25T02:42:00-05:00"><meta property="article:modified_time" content="2010-05-25T02:42:00-05:00"><meta property="article:tag" content="Git"><meta property="article:tag" content="Gitosis"><link rel=canonical href=http://jmeridth.com/posts/gitosis-and-gitweb-part-1/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.aa5ef26fa979d6793724ae2dbd71efa94fd16cb1c5c7db3b6651f21f9892a5fd.css integrity="sha256-ql7yb6l51nk3JK4tvXHvqU/RbLHFx9s7ZlHyH5iSpf0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/css_dark_mode_gist_embed_code.min.5f4f026828cc544c1497785bca628b4ddc8a6c1f154cc2b83c87a13ceaff419a.css integrity="sha256-X08CaCjMVEwUl3hbymKLTdyKbB8VTMK4PIehPOr/QZo=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/favicon.ico sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=http://jmeridth.com/>Learn, Converse, Share
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/talks/>Talks</a></li><li class=navigation-item><a class=navigation-link href=/contact/>Contact Me</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://jmeridth.com/posts/gitosis-and-gitweb-part-1/>Gitosis and Gitweb - Part 1 - Setup</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2010-05-25T02:42:00-05:00>May 25, 2010
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
6-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/git/>Git</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/gitosis/>Gitosis</a></span></div></div></header><div class=post-content><p>I’ve had a number of people ask me where they should host their Git repositories. Of course, my default question back is, “Can the code be public or does it need to be private?”. Usually they say, “public”. Therefore, my repsonse is <a href=http://github.com class=external-link target=_blank rel=noopener>Github.com</a>. If they say, “private” I still say Github. If they don&rsquo;t <a href=http://github.com/security class=external-link target=_blank rel=noopener>&ldquo;trust&rdquo; Github</a>, which they should - click the link, then my response is <a href="http://eagain.net/gitweb/?p=gitosis.git;a=summary" class=external-link target=_blank rel=noopener>Gitosis</a> and <a href=http://git.wiki.kernel.org/index.php/Gitweb class=external-link target=_blank rel=noopener>Gitweb</a>. This is by no means the only solution. I’m aware of other ones like Gitorious. I’ve never used Gitorious.</p><p>Back to Gitosis. My personal Gitosis server is a slice at <a href=http://slicehost.com class=external-link target=_blank rel=noopener>Slicehost.com</a>. You can use an Ubuntu server at home as long as you have remote access. I’ve personally only used Gitosis with an Ubuntu slice, so I don’t know if there are any quirks with other Linux distributions. After setting up a slice (after following the instructions <a href=http://articles.slicehost.com/2008/11/28/ubuntu-intrepid-setup-page-1 class=external-link target=_blank rel=noopener>here</a> and <a href=http://articles.slicehost.com/2008/11/28/ubuntu-intrepid-setup-page-2 class=external-link target=_blank rel=noopener>here</a>) I am ready to go.</p><p>Notice: This post is a combination of <a href=http://scie.nti.st/2007/11/14/hosting-git-repositories-the-easy-and-secure-way class=external-link target=_blank rel=noopener>scie.nti.st’s gitosis post</a> and <a href=http://progit.org/book/ch4-7.html class=external-link target=_blank rel=noopener>Scott Chacon’s Pro Git gitosis section</a>. They are my de facto references. Maybe my own will be now. :)</p><p>“Enough talk. Let’s fight” ~Po, Kung Fu Panda</p><h2 id=intall-git>Intall Git
<a class=heading-link href=#intall-git><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>After logging into your box, let’s install Git (if not already installed):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt-get install git-core
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>After this operation, 16.3MB of additional disk space will be used.
</span></span><span class=line><span class=cl>Do you want to <span class=k>continue</span> <span class=o>[</span>Y/n<span class=o>]</span>?
</span></span></code></pre></div><p>Press enter or type ‘Y’ and press enter and git will be installed. Type the following to confirm:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ &gt; git --version
</span></span></code></pre></div><p>and you’ll see something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ &gt; git --version
</span></span><span class=line><span class=cl>git version 1.6.3.3
</span></span></code></pre></div><h2 id=intall-python-setuptools>Intall python-setuptools
<a class=heading-link href=#intall-python-setuptools><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Also install the python-setuptools because we’ll need them (gitosis is written in python):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ apt-get install python-setuptools
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>After this operation, 1126kB of additonal disk space will be used.
</span></span><span class=line><span class=cl>Do you want to <span class=k>continue</span> <span class=o>[</span>Y/n<span class=o>]</span>?
</span></span></code></pre></div><p>Press enter or type ‘Y’ and press enter and python-setuptools will be installed.</p><h2 id=download-gitosis>Download Gitosis
<a class=heading-link href=#download-gitosis><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>We need to clone the gitosis source locally to install it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mkdir src <span class=o>&amp;&amp;</span> <span class=nb>cd</span> src
</span></span><span class=line><span class=cl>~/src $ git clone git://eagain.net/gitosis.git
</span></span><span class=line><span class=cl>Initialized empty Git repository in /root/src/gitosis/.git/
</span></span><span class=line><span class=cl>remote: Counting objects: 614, <span class=k>done</span>.
</span></span><span class=line><span class=cl>remote: Compressing objects: 100% <span class=o>(</span>183/183<span class=o>)</span>, <span class=k>done</span>.
</span></span><span class=line><span class=cl>remote: Total <span class=m>614</span> <span class=o>(</span>delta 434<span class=o>)</span>, reused <span class=m>594</span> <span class=o>(</span>delta 422<span class=o>)</span>
</span></span><span class=line><span class=cl>Receiving objects: 100% <span class=o>(</span>614/614<span class=o>)</span>, 93.82 KiB, <span class=k>done</span>.
</span></span><span class=line><span class=cl>Resolving deltas: 100% <span class=o>(</span>434/434<span class=o>)</span>, <span class=k>done</span>.
</span></span></code></pre></div><h2 id=install-gitosis>Install Gitosis
<a class=heading-link href=#install-gitosis><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Now let’s install it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~/src $ <span class=nb>cd</span> gitosis
</span></span><span class=line><span class=cl>~/src/gitosis $ python setup.py install
</span></span></code></pre></div><script src=https://gist.github.com/jmeridth/352769.js></script><p>Gitosis is now installed. Next steps are to create git user and handle a file permission on a git hook.</p><h2 id=create-git-user>Create Git User
<a class=heading-link href=#create-git-user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo adduser <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --system <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --shell /bin/bash <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --gecos <span class=s1>&#39;git version control&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --group <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --disabled-password <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --home /home/git <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  git
</span></span></code></pre></div><p>You’ll see something like the following if it is successful</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Adding system user <span class=s1>&#39;git&#39;</span> <span class=o>(</span>UID 103<span class=o>)</span> ...
</span></span><span class=line><span class=cl>Adding new group <span class=s1>&#39;git&#39;</span> <span class=o>(</span>GID 105<span class=o>)</span> ...
</span></span><span class=line><span class=cl>Adding new user <span class=s1>&#39;git&#39;</span> <span class=o>(</span>UID 103<span class=o>)</span> with group <span class=s1>&#39;git&#39;</span> ...
</span></span><span class=line><span class=cl>Creating home directory <span class=s1>&#39;/home/git&#39;</span> ...
</span></span></code></pre></div><h2 id=use-local-public-ssh-key>Use local, public ssh key
<a class=heading-link href=#use-local-public-ssh-key><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>You need to initially use your public ssh key (id_rsa.pub). If you have one, it will be at $HOME/.ssh/id_rsa.pub and if you have never generated one, you can do so by running the following command (accept the default location and you don’t need to enter a passphrase when prompted):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh-keygen -t rsa
</span></span></code></pre></div><p>Now you need to upload it to the server/slice. I usually use the scp (secure copy command):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scp <span class=nv>$HOME</span>/.ssh/id_rsa.pub user@123.123.123.123:/tmp/
</span></span></code></pre></div><p>This will upload the local id_rsa.pub file to the /tmp/ folder on the server. Why there? So that the git user can use it. How is that possible? The folder has permissions of 777 (drwxrwxrwt) meaning everyone has read and write access to it.</p><h3 id=sidenote-ssh-port>Sidenote: SSH Port
<a class=heading-link href=#sidenote-ssh-port><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>If you have your sshd daemon running on a different port other than 22 (which is the default, but I highly suggest changing), then you need to use scp like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scp -P <span class=m>12345</span> <span class=nv>$HOME</span>/.ssh/id_rsa.pub user@123.123.123.123:/tmp/
</span></span></code></pre></div><p>I believe the “-P” option must be capitalized.</p><h2 id=initialize-gitosis-admin-repository>Initialize gitosis-admin repository
<a class=heading-link href=#initialize-gitosis-admin-repository><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>On the server, issue the following command to set your public ssh key as the first authorized key of a new gitosis-admin repository:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -H -u git gitosis-init &lt; /tmp/id_rsa.pub
</span></span></code></pre></div><p>You will see something like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ $ sudo -H -u git gitosis-init &lt; /tmp/id_rsa.pub
</span></span><span class=line><span class=cl>Initialized empty Git repository in /home/git/repositories/gitosis-admin.git/
</span></span><span class=line><span class=cl>Reinitialized existing Git repository in /home/git/repositories/gitosis-admin.git/
</span></span></code></pre></div><p>This means it was successful.</p><p>Take note: If you put your id_rsa.pub file in a different location you need to use that instead of /tmp/id_rsa.pub</p><h2 id=change-permissions-on-post-update-hook>Change Permissions on post-update hook
<a class=heading-link href=#change-permissions-on-post-update-hook><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>You have to set the permissions on the post-update git hook of the gitosis-admin repository so that gitosis-admin can add new repository structures when they are added/removed to/from the gitosis.conf file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo chmod <span class=m>7555</span> /home/git/repositories/gitosis-admin.git/hooks/post-update
</span></span></code></pre></div><p>Note: <em>First round of this post, I didn’t make this change. When I added a new project, it failed because this hook didn’t have the right permissions.</em></p><h2 id=clone-gitosis-admin-repository>Clone gitosis-admin repository
<a class=heading-link href=#clone-gitosis-admin-repository><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Now we’re going to use Git to administrate this gitosis instance. I think that is pretty ingenius. Let’s clone the gitosis-admin repository locally:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ &gt; git clone git@YOUR_SERVER_HOSTNAME:gitosis-admin.git
</span></span><span class=line><span class=cl>Initialized empty Git repository in /Users/user/gitosis-admin/.git/
</span></span><span class=line><span class=cl>remote: Counting objects: 5, <span class=k>done</span>.
</span></span><span class=line><span class=cl>remote: Compressing objects: 100% <span class=o>(</span>4/4<span class=o>)</span>, <span class=k>done</span>.
</span></span><span class=line><span class=cl>Receiving objects: 100% <span class=o>(</span>5/5<span class=o>)</span>, <span class=k>done</span>.
</span></span><span class=line><span class=cl>Resolving deltas: 100% <span class=o>(</span>1/1<span class=o>)</span>, <span class=k>done</span>.
</span></span><span class=line><span class=cl>remote: Total <span class=m>5</span> <span class=o>(</span>delta 1<span class=o>)</span>, reused <span class=m>5</span> <span class=o>(</span>delta 1<span class=o>)</span>
</span></span><span class=line><span class=cl>~ &gt; <span class=nb>cd</span> gitosis-admin
</span></span></code></pre></div><p>We are now in the gitosis-admin repository folder locally</p><h3 id=two-most-common-errors>Two most common errors
<a class=heading-link href=#two-most-common-errors><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><strong>FIRST ONE:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ &gt; git clone git@YOUR_SERVER_HOSTNAME:gitosis-admin.git
</span></span><span class=line><span class=cl>Initialzed empty Git repository in /Users/user/gitosis-admin/.git/
</span></span><span class=line><span class=cl>ssh: connect to host YOUR_SERVER_HOSTNAME port 22: Connection refused
</span></span><span class=line><span class=cl>fatal: The remote end hung up unexpectedly
</span></span></code></pre></div><p>it is because you have used a port for SSH other than port 22 (the default). To fix this, you need to edit your .ssh/config file and add the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Host YOUR_SERVER_HOSTNAME
</span></span><span class=line><span class=cl>Port YOUR_PORT
</span></span></code></pre></div><p>Of course, you need to put in your server hostname and port number (i.e., mydomain.com and 12345)</p><p><strong>SECOND ONE:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ &gt; git clone git@YOUR_SERVER_HOSTNAME:gitosis-admin.git
</span></span><span class=line><span class=cl>Initialzed empty Git repository in /Users/user/gitosis-admin/.git/
</span></span><span class=line><span class=cl>Permission denied <span class=o>(</span>publickey<span class=o>)</span>.
</span></span><span class=line><span class=cl>fatal: The remote end hung up unexpectedly
</span></span></code></pre></div><p>This has usually hit me because I locked down my /etc/ssh/sshd_config file to only allow in certain users or groups. I have to change the AllowUsers line in my file from:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>AllowUsers jmeridth
</span></span></code></pre></div><p>to</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>AllowUsers jmeridth git
</span></span></code></pre></div><p>Once I restart the ssh daemon:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ &gt; sudo /etc/init.d/ssh restart
</span></span></code></pre></div><p>Now the git user has access to reach my server/slice via ssh.</p><h3 id=the-local-gitosis-admin-repository>The local gitosis-admin repository
<a class=heading-link href=#the-local-gitosis-admin-repository><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>You now have a local clone of the gitosis-admin repository. The contents are only a conf file and key directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~/gitosis-admin<span class=o>(</span>master<span class=o>)</span> &gt; ls
</span></span><span class=line><span class=cl>total <span class=m>8</span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> user staff <span class=m>1148</span> May <span class=m>22</span> 21:31 gitosis.conf
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>3</span> user staff <span class=m>1028</span> May <span class=m>22</span> 21:31 keydir
</span></span></code></pre></div><p>Next Park: <a href=/posts/gitosis-and-gitweb-part-2>Gitosis and Gitweb Part 2</a></p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2007 -
2025
Jason Meridth
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4W46VMK7DQ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4W46VMK7DQ")</script></body></html>