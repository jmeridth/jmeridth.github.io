<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<title>Gitosis and Gitweb - Part 1 - Setup | JM (Jason Meridth)</title>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=generator content="Hugo 0.92.2">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=keywords content="git,gitosis">
<meta name=description content="I’ve had a number of people ask me where they should host their Git repositories. Of course, my default question back is, “Can the code be public or does …">
<link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16>
<link rel=stylesheet type=text/css media=screen href=/css/normalize.css>
<link rel=stylesheet type=text/css media=screen href=/css/main.css>
<link rel=stylesheet type=text/css media=screen href=/css/all.css><link rel=stylesheet href=/css/katex.css crossorigin=anonymous>
<script defer src=/js/katex.js integrity=sha384-HELAAZU8xvHgfT/8z4Mhmu+E2z3oBrMEuywaMh/CEd5uTZIDSct7TEaX+S43+dOi crossorigin=anonymous></script>
<script defer src=/js/auto-render.js integrity=sha384-0QrOZ8WIARJUoT5pH7Iuzi7iq0mXUXLF9yj5ZvYxTkMRv1zcaPQiOQ9ksHYbKw7M crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script>
<script>localStorage.setItem('theme','dark')</script>
<meta property="og:title" content="Gitosis and Gitweb - Part 1 - Setup">
<meta property="og:description" content="I’ve had a number of people ask me where they should host their Git repositories. Of course, my default question back is, “Can the code be public or does it need to be private?”. Usually they say, “public”. Therefore, my repsonse is Github.com. If they say, “private” I still say Github. If they don&rsquo;t “trust” Github, which they should - click the link, then my response is Gitosis and Gitweb. This is by no means the only solution.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://blog.jasonmeridth.com/posts/gitosis-and-gitweb-part-1/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2010-05-25T02:42:00-05:00">
<meta property="article:modified_time" content="2010-05-25T02:42:00-05:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Gitosis and Gitweb - Part 1 - Setup">
<meta name=twitter:description content="I’ve had a number of people ask me where they should host their Git repositories. Of course, my default question back is, “Can the code be public or does it need to be private?”. Usually they say, “public”. Therefore, my repsonse is Github.com. If they say, “private” I still say Github. If they don&rsquo;t “trust” Github, which they should - click the link, then my response is Gitosis and Gitweb. This is by no means the only solution.">
<meta itemprop=name content="Gitosis and Gitweb - Part 1 - Setup">
<meta itemprop=description content="I’ve had a number of people ask me where they should host their Git repositories. Of course, my default question back is, “Can the code be public or does it need to be private?”. Usually they say, “public”. Therefore, my repsonse is Github.com. If they say, “private” I still say Github. If they don&rsquo;t “trust” Github, which they should - click the link, then my response is Gitosis and Gitweb. This is by no means the only solution."><meta itemprop=datePublished content="2010-05-25T02:42:00-05:00">
<meta itemprop=dateModified content="2010-05-25T02:42:00-05:00">
<meta itemprop=wordCount content="1100">
<meta itemprop=keywords content="git,gitosis,">
</head>
<body>
<header>
<div id=avatar>
<a href=http://blog.jasonmeridth.com/><img src=/img/avatar.jpg alt="JM (Jason Meridth)"></a>
</div>
<div id=titletext>
<h2 id=title><a href=http://blog.jasonmeridth.com/>JM (Jason Meridth)</a></h2>
</div>
<div id=title-description>
<p id=subtitle>Learn, Converse, Share</p>
<div id=social>
<nav><ul>
<li><a href=https://github.com/jmeridth><i title=Github class="icons fab fa-github"></i></a></li>
<li><a href=mailto:jmeridth@gmail.com><i title=Email class="icons fas fa-envelope"></i></a></li>
<li><a href=https://linkedin.com/in/jmeridth><i title=LinkedIn class="icons fab fa-linkedin"></i></a></li>
<li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li>
<li><a><i title="Switch Dark Mode" class="dark-mode icons fas fa-moon"></i></a></li>
</ul></nav>
</div>
</div>
<div id=mainmenu>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>All Posts</a></li>
<li><a href=/about>About</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/categories>Categories</a></li>
</ul>
</nav>
</div>
</header>
<main>
<div class=post>
<article>
<div class=post-header>
<div class=meta>
<div class=date>
<span class=day>25</span>
<span class=rest>May 2010</span>
</div>
</div>
<div class=matter>
<h1 class=title>Gitosis and Gitweb - Part 1 - Setup</h1>
<p class=post-meta>
<span class=post-meta>
&nbsp;<i class="fas fa-clock"></i>&nbsp;6&nbsp;minutes
&nbsp;| &nbsp;
<i class="fas fa-book"></i>&nbsp;1100&nbsp;words
</span>
</p>
</div>
</div>
<div class=markdown>
<p>I’ve had a number of people ask me where they should host their Git repositories. Of course, my default question back is, “Can the code be public or does it need to be private?”. Usually they say, “public”. Therefore, my repsonse is <a href=http://github.com target=_blank>Github.com</a>. If they say, “private” I still say Github. If they don&rsquo;t <a href=http://github.com/security target=_blank>“trust” Github</a>, which they should - click the link, then my response is <a href="http://eagain.net/gitweb/?p=gitosis.git;a=summary" target=_blank>Gitosis</a> and <a href=http://git.wiki.kernel.org/index.php/Gitweb target=_blank>Gitweb</a>. This is by no means the only solution. I’m aware of other ones like Gitorious. I’ve never used Gitorious.</p>
<p>Back to Gitosis. My personal Gitosis server is a slice at <a href=http://slicehost.com target=_blank>Slicehost.com</a>. You can use an Ubuntu server at home as long as you have remote access. I’ve personally only used Gitosis with an Ubuntu slice, so I don’t know if there are any quirks with other Linux distributions. After setting up a slice (after following the instructions <a href=http://articles.slicehost.com/2008/11/28/ubuntu-intrepid-setup-page-1 target=_blank>here</a> and <a href=http://articles.slicehost.com/2008/11/28/ubuntu-intrepid-setup-page-2 target=_blank>here</a>) I am ready to go.</p>
<p>Notice: This post is a combination of <a href=http://scie.nti.st/2007/11/14/hosting-git-repositories-the-easy-and-secure-way target=_blank>scie.nti.st’s gitosis post</a> and <a href=http://progit.org/book/ch4-7.html target=_blank>Scott Chacon’s Pro Git gitosis section</a>. They are my de facto references. Maybe my own will be now. :)</p>
<p>“Enough talk. Let’s fight” ~Po, Kung Fu Panda</p>
<h2 id=intall-git>Intall Git</h2>
<p>After logging into your box, let’s install Git (if not already installed):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install git-core
...
After this operation, 16.3MB of additional disk space will be used.
Do you want to <span style=color:#66d9ef>continue</span> <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span>?
</code></pre></div><p>Press enter or type ‘Y’ and press enter and git will be installed. Type the following to confirm:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ &gt; git --version
</code></pre></div><p>and you’ll see something like:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ &gt; git --version
git version 1.6.3.3
</code></pre></div><h2 id=intall-python-setuptools>Intall python-setuptools</h2>
<p>Also install the python-setuptools because we’ll need them (gitosis is written in python):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ apt-get install python-setuptools
...
After this operation, 1126kB of additonal disk space will be used.
Do you want to <span style=color:#66d9ef>continue</span> <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span>?
</code></pre></div><p>Press enter or type ‘Y’ and press enter and python-setuptools will be installed.</p>
<h2 id=download-gitosis>Download Gitosis</h2>
<p>We need to clone the gitosis source locally to install it:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mkdir src <span style=color:#f92672>&amp;&amp;</span> cd src
~/src $ git clone git://eagain.net/gitosis.git
Initialized empty Git repository in /root/src/gitosis/.git/
remote: Counting objects: 614, <span style=color:#66d9ef>done</span>.
remote: Compressing objects: 100% <span style=color:#f92672>(</span>183/183<span style=color:#f92672>)</span>, <span style=color:#66d9ef>done</span>.
remote: Total <span style=color:#ae81ff>614</span> <span style=color:#f92672>(</span>delta 434<span style=color:#f92672>)</span>, reused <span style=color:#ae81ff>594</span> <span style=color:#f92672>(</span>delta 422<span style=color:#f92672>)</span>
Receiving objects: 100% <span style=color:#f92672>(</span>614/614<span style=color:#f92672>)</span>, 93.82 KiB, <span style=color:#66d9ef>done</span>.
Resolving deltas: 100% <span style=color:#f92672>(</span>434/434<span style=color:#f92672>)</span>, <span style=color:#66d9ef>done</span>.
</code></pre></div><h2 id=install-gitosis>Install Gitosis</h2>
<p>Now let’s install it:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~/src $ cd gitosis
~/src/gitosis $ python setup.py install
</code></pre></div><p>{% gist 352769 %}</p>
<p>Gitosis is now installed. Next steps are to create git user and handle a file permission on a git hook.</p>
<h2 id=create-git-user>Create Git User</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo adduser <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --system <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --shell /bin/bash <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --gecos <span style=color:#e6db74>&#39;git version control&#39;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --group <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --disabled-password <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --home /home/git <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  git
</code></pre></div><p>You’ll see something like the following if it is successful</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Adding system user <span style=color:#e6db74>&#39;git&#39;</span> <span style=color:#f92672>(</span>UID 103<span style=color:#f92672>)</span> ...
Adding new group <span style=color:#e6db74>&#39;git&#39;</span> <span style=color:#f92672>(</span>GID 105<span style=color:#f92672>)</span> ...
Adding new user <span style=color:#e6db74>&#39;git&#39;</span> <span style=color:#f92672>(</span>UID 103<span style=color:#f92672>)</span> with group <span style=color:#e6db74>&#39;git&#39;</span> ...
Creating home directory <span style=color:#e6db74>&#39;/home/git&#39;</span> ...
</code></pre></div><h2 id=use-local-public-ssh-key>Use local, public ssh key</h2>
<p>You need to initially use your public ssh key (id_rsa.pub). If you have one, it will be at $HOME/.ssh/id_rsa.pub and if you have never generated one, you can do so by running the following command (accept the default location and you don’t need to enter a passphrase when prompted):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh-keygen -t rsa
</code></pre></div><p>Now you need to upload it to the server/slice. I usually use the scp (secure copy command):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>scp $HOME/.ssh/id_rsa.pub user@123.123.123.123:/tmp/
</code></pre></div><p>This will upload the local id_rsa.pub file to the /tmp/ folder on the server. Why there? So that the git user can use it. How is that possible? The folder has permissions of 777 (drwxrwxrwt) meaning everyone has read and write access to it.</p>
<h3 id=sidenote-ssh-port>Sidenote: SSH Port</h3>
<p>If you have your sshd daemon running on a different port other than 22 (which is the default, but I highly suggest changing), then you need to use scp like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>scp -P <span style=color:#ae81ff>12345</span> $HOME/.ssh/id_rsa.pub user@123.123.123.123:/tmp/
</code></pre></div><p>I believe the “-P” option must be capitalized.</p>
<h2 id=initialize-gitosis-admin-repository>Initialize gitosis-admin repository</h2>
<p>On the server, issue the following command to set your public ssh key as the first authorized key of a new gitosis-admin repository:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo -H -u git gitosis-init &lt; /tmp/id_rsa.pub
</code></pre></div><p>You will see something like the following:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ $ sudo -H -u git gitosis-init &lt; /tmp/id_rsa.pub
Initialized empty Git repository in /home/git/repositories/gitosis-admin.git/
Reinitialized existing Git repository in /home/git/repositories/gitosis-admin.git/
</code></pre></div><p>This means it was successful.</p>
<p>Take note: If you put your id_rsa.pub file in a different location you need to use that instead of /tmp/id_rsa.pub</p>
<h2 id=change-permissions-on-post-update-hook>Change Permissions on post-update hook</h2>
<p>You have to set the permissions on the post-update git hook of the gitosis-admin repository so that gitosis-admin can add new repository structures when they are added/removed to/from the gitosis.conf file.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo chmod <span style=color:#ae81ff>7555</span> /home/git/repositories/gitosis-admin.git/hooks/post-update
</code></pre></div><p>Note: <em>First round of this post, I didn’t make this change. When I added a new project, it failed because this hook didn’t have the right permissions.</em></p>
<h2 id=clone-gitosis-admin-repository>Clone gitosis-admin repository</h2>
<p>Now we’re going to use Git to administrate this gitosis instance. I think that is pretty ingenius. Let’s clone the gitosis-admin repository locally:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ &gt; git clone git@YOUR_SERVER_HOSTNAME:gitosis-admin.git
Initialized empty Git repository in /Users/user/gitosis-admin/.git/
remote: Counting objects: 5, <span style=color:#66d9ef>done</span>.
remote: Compressing objects: 100% <span style=color:#f92672>(</span>4/4<span style=color:#f92672>)</span>, <span style=color:#66d9ef>done</span>.
Receiving objects: 100% <span style=color:#f92672>(</span>5/5<span style=color:#f92672>)</span>, <span style=color:#66d9ef>done</span>.
Resolving deltas: 100% <span style=color:#f92672>(</span>1/1<span style=color:#f92672>)</span>, <span style=color:#66d9ef>done</span>.
remote: Total <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>delta 1<span style=color:#f92672>)</span>, reused <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>delta 1<span style=color:#f92672>)</span>
~ &gt; cd gitosis-admin
</code></pre></div><p>We are now in the gitosis-admin repository folder locally</p>
<h3 id=two-most-common-errors>Two most common errors</h3>
<p><strong>FIRST ONE:</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ &gt; git clone git@YOUR_SERVER_HOSTNAME:gitosis-admin.git
Initialzed empty Git repository in /Users/user/gitosis-admin/.git/
ssh: connect to host YOUR_SERVER_HOSTNAME port 22: Connection refused
fatal: The remote end hung up unexpectedly
</code></pre></div><p>it is because you have used a port for SSH other than port 22 (the default). To fix this, you need to edit your .ssh/config file and add the following:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Host YOUR_SERVER_HOSTNAME
Port YOUR_PORT
</code></pre></div><p>Of course, you need to put in your server hostname and port number (i.e., mydomain.com and 12345)</p>
<p><strong>SECOND ONE:</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ &gt; git clone git@YOUR_SERVER_HOSTNAME:gitosis-admin.git
Initialzed empty Git repository in /Users/user/gitosis-admin/.git/
Permission denied <span style=color:#f92672>(</span>publickey<span style=color:#f92672>)</span>.
fatal: The remote end hung up unexpectedly
</code></pre></div><p>This has usually hit me because I locked down my /etc/ssh/sshd_config file to only allow in certain users or groups. I have to change the AllowUsers line in my file from:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>AllowUsers jmeridth
</code></pre></div><p>to</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>AllowUsers jmeridth git
</code></pre></div><p>Once I restart the ssh daemon:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ &gt; sudo /etc/init.d/ssh restart
</code></pre></div><p>Now the git user has access to reach my server/slice via ssh.</p>
<h3 id=the-local-gitosis-admin-repository>The local gitosis-admin repository</h3>
<p>You now have a local clone of the gitosis-admin repository. The contents are only a conf file and key directory:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~/gitosis-admin<span style=color:#f92672>(</span>master<span style=color:#f92672>)</span> &gt; ls
total <span style=color:#ae81ff>8</span>
-rw-r--r-- <span style=color:#ae81ff>1</span> user staff <span style=color:#ae81ff>1148</span> May <span style=color:#ae81ff>22</span> 21:31 gitosis.conf
drwxr-xr-x <span style=color:#ae81ff>3</span> user staff <span style=color:#ae81ff>1028</span> May <span style=color:#ae81ff>22</span> 21:31 keydir
</code></pre></div><p>Next Park: <a href=/posts/gitosis-and-gitweb-part-2>Gitosis and Gitweb Part 2</a></p>
</div>
<div class=tags>
<div class=taxosfloating_left>
<p>Tags</p>
</div>
<div class=termsfloating_right>
<p>
<a href=/tags/git/>git</a>
<a href=/tags/gitosis/>gitosis</a>
</p>
</div>
<div class=clearit></div>
</div>
</article>
</div>
</main>
<footer>
© Copyright notice | <a href=https://github.com/dataCobra/hugo-vitae>Vitae</a> theme for <a href=https://gohugo.io>Hugo</a>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-38456568-3','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</footer><script src=/js/dark-mode.js></script>
</body>
</html>