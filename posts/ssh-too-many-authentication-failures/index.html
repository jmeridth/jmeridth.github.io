<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<title>SSH - Too Many Authentication Failures | JM (Jason Meridth)</title>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=generator content="Hugo 0.92.2">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=keywords content="ssh">
<meta name=description content="Problem I started seeing this error recently and had brain farted on why.
Received disconnect from 123.123.132.132: Too many authentication failures for …">
<link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16>
<link rel=stylesheet type=text/css media=screen href=/css/normalize.css>
<link rel=stylesheet type=text/css media=screen href=/css/main.css>
<link rel=stylesheet type=text/css media=screen href=/css/all.css><link rel=stylesheet href=/css/katex.css crossorigin=anonymous>
<script defer src=/js/katex.js integrity=sha384-HELAAZU8xvHgfT/8z4Mhmu+E2z3oBrMEuywaMh/CEd5uTZIDSct7TEaX+S43+dOi crossorigin=anonymous></script>
<script defer src=/js/auto-render.js integrity=sha384-0QrOZ8WIARJUoT5pH7Iuzi7iq0mXUXLF9yj5ZvYxTkMRv1zcaPQiOQ9ksHYbKw7M crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script>
<script>localStorage.setItem('theme','dark')</script>
<meta property="og:title" content="SSH - Too Many Authentication Failures">
<meta property="og:description" content="Problem
I started seeing this error recently and had brain farted on why.
Received disconnect from 123.123.132.132: Too many authentication failures for hostname

After a bit of googling it came back to me.  This is because I&rsquo;ve loaded too many keys into my ssh-agent locally (ssh-add).  Why did you do that?  Well, because it is easier than specifying the IdentityFile on the cli when trying to connect.  But there is a threshhold.  This is set by the ssh host by the MaxAuthTries setting in /etc/ssh/sshd_config.  The default is 6.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://blog.jasonmeridth.com/posts/ssh-too-many-authentication-failures/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-03-28T00:00:00-05:00">
<meta property="article:modified_time" content="2018-03-28T00:00:00-05:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="SSH - Too Many Authentication Failures">
<meta name=twitter:description content="Problem
I started seeing this error recently and had brain farted on why.
Received disconnect from 123.123.132.132: Too many authentication failures for hostname

After a bit of googling it came back to me.  This is because I&rsquo;ve loaded too many keys into my ssh-agent locally (ssh-add).  Why did you do that?  Well, because it is easier than specifying the IdentityFile on the cli when trying to connect.  But there is a threshhold.  This is set by the ssh host by the MaxAuthTries setting in /etc/ssh/sshd_config.  The default is 6.">
<meta itemprop=name content="SSH - Too Many Authentication Failures">
<meta itemprop=description content="Problem
I started seeing this error recently and had brain farted on why.
Received disconnect from 123.123.132.132: Too many authentication failures for hostname

After a bit of googling it came back to me.  This is because I&rsquo;ve loaded too many keys into my ssh-agent locally (ssh-add).  Why did you do that?  Well, because it is easier than specifying the IdentityFile on the cli when trying to connect.  But there is a threshhold.  This is set by the ssh host by the MaxAuthTries setting in /etc/ssh/sshd_config.  The default is 6."><meta itemprop=datePublished content="2018-03-28T00:00:00-05:00">
<meta itemprop=dateModified content="2018-03-28T00:00:00-05:00">
<meta itemprop=wordCount content="320">
<meta itemprop=keywords content="ssh,">
</head>
<body>
<header>
<div id=avatar>
<a href=http://blog.jasonmeridth.com/><img src=/img/avatar.jpg alt="JM (Jason Meridth)"></a>
</div>
<div id=titletext>
<h2 id=title><a href=http://blog.jasonmeridth.com/>JM (Jason Meridth)</a></h2>
</div>
<div id=title-description>
<p id=subtitle>Learn, Converse, Share</p>
<div id=social>
<nav><ul>
<li><a href=https://github.com/jmeridth><i title=Github class="icons fab fa-github"></i></a></li>
<li><a href=mailto:jmeridth@gmail.com><i title=Email class="icons fas fa-envelope"></i></a></li>
<li><a href=https://linkedin.com/in/jmeridth><i title=LinkedIn class="icons fab fa-linkedin"></i></a></li>
<li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li>
<li><a><i title="Switch Dark Mode" class="dark-mode icons fas fa-moon"></i></a></li>
</ul></nav>
</div>
</div>
<div id=mainmenu>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>All Posts</a></li>
<li><a href=/about>About</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/categories>Categories</a></li>
</ul>
</nav>
</div>
</header>
<main>
<div class=post>
<article>
<div class=post-header>
<div class=meta>
<div class=date>
<span class=day>28</span>
<span class=rest>Mar 2018</span>
</div>
</div>
<div class=matter>
<h1 class=title>SSH - Too Many Authentication Failures</h1>
<p class=post-meta>
<span class=post-meta>
&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;minutes
&nbsp;| &nbsp;
<i class="fas fa-book"></i>&nbsp;320&nbsp;words
</span>
</p>
</div>
</div>
<div class=markdown>
<h1 id=problem>Problem</h1>
<p>I started seeing this error recently and had brain farted on why.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Received disconnect from 123.123.132.132: Too many authentication failures <span style=color:#66d9ef>for</span> hostname

</code></pre></div><p>After a bit of googling it came back to me. This is because I&rsquo;ve loaded too many keys into my ssh-agent locally (<code>ssh-add</code>). Why did you do that? Well, because it is easier than specifying the <code>IdentityFile</code> on the cli when trying to connect. But there is a threshhold. This is set by the ssh host by the <code>MaxAuthTries</code> setting in <code>/etc/ssh/sshd_config</code>. The default is 6.</p>
<h1 id=solution-1>Solution 1</h1>
<p>Clean up the keys in your ssh-agent.</p>
<p><code>ssh-add -l</code> lists all the keys you have in your ssh-agent
<code>ssh-add -d key</code> deletes the key from your ssh-agent</p>
<h1 id=solution-2>Solution 2</h1>
<p>You can solve this on the command line like this:</p>
<p><code>ssh -o IdentitiesOnly=yes -i ~/.ssh/example_rsa foo.example.com</code></p>
<p>What is IdentitiesOnly? Explained in Solution 3 below.</p>
<h1 id=solution-3-best>Solution 3 (best)</h1>
<p>Specifiy, explicitly, which key goes to which host(s) in your <code>.ssh/config</code> file.</p>
<p>You need to configure which key (“IdentityFile”) goes with which domain (or host). You also want to handle the case when the specified key doesn’t work, which would usually be because the public key isn’t in ~/.ssh/authorized_keys on the server. The default is for SSH to then try any other keys it has access to, which takes us back to too many attempts. Setting “IdentitiesOnly” to “yes” tells SSH to only try the specified key and, if that fails, fall through to password authentication (presuming the server allows it).</p>
<p>Your ~/.ssh/config would look like:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Host *.myhost.com
  IdentitiesOnly yes
  IdentityFile ~/.ssh/myhost
Host secure.myhost.com
  IdentitiesOnly yes
  IdentityFile ~/.ssh/mysecurehost_rsa
Host *.myotherhost.domain
  IdentitiesOnly yes
  IdentityFile ~/.ssh/myotherhost_rsa
</code></pre></div><p><code>Host</code> is the host the key can connect to
<code>IdentitiesOnly</code> means only to try <em>this</em> specific key to connect, no others
<code>IdentityFile</code> is the path to the key</p>
<p>You can try multiple keys if needed</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Host *.myhost.com
  IdentitiesOnly yes
  IdentityFile ~/.ssh/myhost_rsa
  IdentityFile ~/.ssh/myhost_dsa
</code></pre></div><p>Hope this helps someone else.</p>
<p>Cheers!</p>
</div>
<div class=tags>
<div class=taxosfloating_left>
<p>Tags</p>
</div>
<div class=termsfloating_right>
<p>
<a href=/tags/ssh/>ssh</a>
</p>
</div>
<div class=clearit></div>
</div>
</article>
</div>
</main>
<footer>
© Copyright notice | <a href=https://github.com/dataCobra/hugo-vitae>Vitae</a> theme for <a href=https://gohugo.io>Hugo</a>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-38456568-3','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</footer><script src=/js/dark-mode.js></script>
</body>
</html>